#!/usr/bin/env ts-node\n\nimport axios from 'axios';\nimport WebSocket from 'ws';\nimport { performance } from 'perf_hooks';\nimport TestHelper, { TEST_CONFIG } from '../integration/test-helper';\n\n// Simple color utility\nconst colors = {\n  red: (text: string) => `\\x1b[31m${text}\\x1b[0m`,\n  green: (text: string) => `\\x1b[32m${text}\\x1b[0m`,\n  yellow: (text: string) => `\\x1b[33m${text}\\x1b[0m`,\n  cyan: (text: string) => `\\x1b[36m${text}\\x1b[0m`,\n  gray: (text: string) => `\\x1b[90m${text}\\x1b[0m`,\n  bold: (text: string) => `\\x1b[1m${text}\\x1b[0m`\n};\n\nclass DemoScenario {\n  private static step = 0;\n  private static results: any = {};\n\n  static async run(): Promise<void> {\n    console.log(colors.cyan(colors.bold('\\nğŸš€ HCM ë¶„ì‚° ì‹œìŠ¤í…œ í†µí•© ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤')));\n    console.log(colors.cyan('='.repeat(60)));\n    console.log(colors.gray('ì¸ì  ìë³¸ ê´€ë¦¬ ê¸°ë°˜ ë¶„ì‚° ì‹œìŠ¤í…œ ìµœì í™” í”„ë¡œì íŠ¸'));\n    console.log(colors.gray('ì‹¤ì‹œê°„ ì¥ì•  ëŒ€ì‘ ë° ìë™ ë§¤ì¹­ ì‹œì—°\\n'));\n\n    try {\n      await this.checkSystemHealth();\n      await this.scenario1_EmployeeOnboarding();\n      await this.scenario2_TaskMatching();\n      await this.scenario3_DistributedExecution();\n      await this.scenario4_FailureRecovery();\n      await this.scenario5_RealTimeMonitoring();\n      await this.showFinalResults();\n      \n    } catch (error: any) {\n      console.error(colors.red(colors.bold('\\nâŒ ë°ëª¨ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:')), error.message);\n      process.exit(1);\n    }\n  }\n\n  private static async checkSystemHealth(): Promise<void> {\n    this.printStepHeader('ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬');\n    \n    console.log(colors.yellow('ğŸ” ëª¨ë“  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì¤‘...'));\n    \n    const startTime = performance.now();\n    await TestHelper.waitForServices();\n    const healthCheckTime = Math.round(performance.now() - startTime);\n    \n    const healthStatus = await TestHelper.validateServiceHealth();\n    \n    console.log(colors.green('âœ… ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬ ì™„ë£Œ'));\n    console.log(`   â±ï¸  ì†Œìš”ì‹œê°„: ${healthCheckTime}ms`);\n    \n    for (const [service, healthy] of Object.entries(healthStatus)) {\n      const status = healthy ? colors.green('ğŸŸ¢ ì •ìƒ') : colors.red('ğŸ”´ ì˜¤ë¥˜');\n      console.log(`   ${status} ${service.toUpperCase()} ì„œë¹„ìŠ¤`);\n    }\n    \n    this.results.healthCheck = { duration: healthCheckTime, services: healthStatus };\n    await this.delay(2000);\n  }\n\n  private static async scenario1_EmployeeOnboarding(): Promise<void> {\n    this.printStepHeader('ì‹œë‚˜ë¦¬ì˜¤ 1: ì‹ ê·œ ì§ì› ì˜¨ë³´ë”© ì›Œí¬í”Œë¡œìš°');\n    \n    console.log(colors.yellow('ğŸ‘¤ ì‹ ê·œ ì§ì› ë“±ë¡ ì‹œì‘...'));\n    \n    const employeeData = {\n      name: 'ê¹€ê°œë°œ',\n      email: `kim.developer.${Date.now()}@company.com`,\n      department: 'Engineering',\n      location: 'Seoul',\n      role: 'Senior Full-Stack Developer',\n      skills: [\n        { name: 'JavaScript', level: 'expert', yearsOfExperience: 6 },\n        { name: 'TypeScript', level: 'advanced', yearsOfExperience: 4 },\n        { name: 'React', level: 'expert', yearsOfExperience: 5 },\n        { name: 'Node.js', level: 'advanced', yearsOfExperience: 4 }\n      ],\n      availability: {\n        available: true,\n        capacity: 85,\n        scheduledHours: 10,\n        maxHoursPerWeek: 40\n      }\n    };\n\n    console.log(colors.cyan('ğŸ“‹ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰:'));\n    console.log('   1ï¸âƒ£  HR ì‹œìŠ¤í…œì— ì§ì› ì •ë³´ ë“±ë¡');\n    console.log('   2ï¸âƒ£  Edge Agent ë¶„ì‚° ì‹œìŠ¤í…œ ì´ˆê¸°í™”');\n    console.log('   3ï¸âƒ£  ì´ˆê¸° ì‘ì—… ì¶”ì²œ ìƒì„±');\n    \n    const startTime = performance.now();\n    \n    try {\n      const response = await axios.post(\n        `${TEST_CONFIG.services.gateway.url}/workflows/employee-onboarding`,\n        employeeData,\n        { timeout: 30000 }\n      );\n\n      const duration = Math.round(performance.now() - startTime);\n      \n      if (response.data.status === 'completed') {\n        console.log(colors.green('âœ… ì˜¨ë³´ë”© ì›Œí¬í”Œë¡œìš° ì™„ë£Œ'));\n        console.log(`   ğŸ‘¤ ì§ì› ID: ${response.data.results.employee.id}`);\n        console.log(`   â±ï¸  ì´ ì†Œìš”ì‹œê°„: ${duration}ms`);\n        \n        this.results.onboarding = {\n          employee: response.data.results.employee,\n          duration,\n          success: true\n        };\n      } else {\n        console.log(colors.red('âŒ ì˜¨ë³´ë”© ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨'));\n        this.results.onboarding = { success: false };\n      }\n    } catch (error: any) {\n      console.log(colors.red(`âŒ ì˜¨ë³´ë”© ì‹¤íŒ¨: ${error.message}`));\n      this.results.onboarding = { success: false };\n    }\n    \n    await this.delay(2000);\n  }\n\n  private static async scenario2_TaskMatching(): Promise<void> {\n    this.printStepHeader('ì‹œë‚˜ë¦¬ì˜¤ 2: ì§€ëŠ¥í˜• ì‘ì—… ë§¤ì¹­ ì‹œìŠ¤í…œ');\n    \n    const taskData = {\n      title: 'ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ë§ˆì´ê·¸ë ˆì´ì…˜',\n      description: 'ê¸°ì¡´ ëª¨ë†€ë¦¬ì‹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ì „í™˜',\n      requiredSkills: [\n        { name: 'Node.js', level: 'advanced', mandatory: true, weight: 9 },\n        { name: 'Docker', level: 'intermediate', mandatory: false, weight: 7 }\n      ],\n      priority: 'high',\n      estimatedHours: 120,\n      deadline: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000),\n      remoteAllowed: true\n    };\n\n    console.log(colors.cyan('ğŸ” ë§¤ì¹­ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰...'));\n    \n    const startTime = performance.now();\n    \n    try {\n      const response = await axios.post(\n        `${TEST_CONFIG.services.gateway.url}/workflows/task-assignment`,\n        taskData,\n        { timeout: 30000 }\n      );\n\n      const duration = Math.round(performance.now() - startTime);\n      \n      if (response.data.status === 'completed') {\n        const results = response.data.results;\n        console.log(colors.green('âœ… ì‘ì—… ë§¤ì¹­ ì™„ë£Œ'));\n        console.log(`   ğŸ“‹ ì‘ì—… ID: ${results.task.id}`);\n        console.log(`   ğŸ¯ ë§¤ì¹­ëœ í›„ë³´ì: ${results.matches.length}ëª…`);\n        console.log(`   â±ï¸  ì†Œìš”ì‹œê°„: ${duration}ms`);\n        \n        this.results.matching = {\n          task: results.task,\n          matches: results.matches,\n          duration,\n          success: true\n        };\n      } else {\n        this.results.matching = { success: false };\n      }\n    } catch (error: any) {\n      console.log(colors.red(`âŒ ì‘ì—… ë§¤ì¹­ ì‹¤íŒ¨: ${error.message}`));\n      this.results.matching = { success: false };\n    }\n    \n    await this.delay(2000);\n  }\n\n  private static async scenario3_DistributedExecution(): Promise<void> {\n    this.printStepHeader('ì‹œë‚˜ë¦¬ì˜¤ 3: ë¶„ì‚° ì‘ì—… ì‹¤í–‰');\n    \n    console.log(colors.yellow('âš¡ Edge Agent ë¶„ì‚° ì‘ì—… ì‹¤í–‰...'));\n\n    const task = {\n      type: 'health_check',\n      payload: { target: 'all_services' },\n      priority: 5\n    };\n\n    try {\n      const response = await axios.post(\n        `${TEST_CONFIG.services.gateway.url}/api/edge/tasks`,\n        task,\n        { timeout: 15000 }\n      );\n      \n      console.log(colors.green('âœ… ë¶„ì‚° ì‘ì—… ì œì¶œ ì™„ë£Œ'));\n      console.log(`   ğŸ¤– í• ë‹¹ëœ Agent: ${response.data.assignedAgent}`);\n      \n      this.results.distributedExecution = {\n        success: true,\n        assignedAgent: response.data.assignedAgent\n      };\n      \n    } catch (error: any) {\n      console.log(colors.red(`âŒ ë¶„ì‚° ì‘ì—… ì‹¤íŒ¨: ${error.message}`));\n      this.results.distributedExecution = { success: false };\n    }\n    \n    await this.delay(2000);\n  }\n\n  private static async scenario4_FailureRecovery(): Promise<void> {\n    this.printStepHeader('ì‹œë‚˜ë¦¬ì˜¤ 4: ììœ¨ ì¥ì•  ë³µêµ¬');\n    \n    console.log(colors.yellow('ğŸ›¡ï¸ ì¥ì•  ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...'));\n    \n    try {\n      const response = await axios.get(\n        `${TEST_CONFIG.services.gateway.url}/workflows/health-monitoring`,\n        { timeout: 20000 }\n      );\n      \n      if (response.data.status === 'completed') {\n        console.log(colors.green('âœ… í—¬ìŠ¤ ëª¨ë‹ˆí„°ë§ ì™„ë£Œ'));\n        console.log('   ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ ì •ìƒ');\n        \n        this.results.failureRecovery = { success: true };\n      } else {\n        this.results.failureRecovery = { success: false };\n      }\n      \n    } catch (error: any) {\n      console.log(colors.red(`âŒ í—¬ìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹¤íŒ¨: ${error.message}`));\n      this.results.failureRecovery = { success: false };\n    }\n    \n    await this.delay(2000);\n  }\n\n  private static async scenario5_RealTimeMonitoring(): Promise<void> {\n    this.printStepHeader('ì‹œë‚˜ë¦¬ì˜¤ 5: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§');\n    \n    console.log(colors.yellow('ğŸ“Š ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì—°ê²°...'));\n    \n    try {\n      const ws = await TestHelper.connectWebSocket(TEST_CONFIG.services.gateway.ws);\n      console.log(colors.green('âœ… WebSocket ì—°ê²° ì„±ê³µ'));\n      \n      let messagesReceived = 0;\n      \n      const messagePromise = new Promise<void>((resolve) => {\n        const timeout = setTimeout(() => {\n          resolve();\n        }, 3000); // 3ì´ˆê°„ ëª¨ë‹ˆí„°ë§\n        \n        ws.on('message', () => {\n          messagesReceived++;\n        });\n        \n        ws.on('error', () => {\n          clearTimeout(timeout);\n          resolve();\n        });\n      });\n      \n      await messagePromise;\n      ws.close();\n      \n      console.log(colors.green(`âœ… ëª¨ë‹ˆí„°ë§ ì™„ë£Œ - ë©”ì‹œì§€ ${messagesReceived}ê°œ ìˆ˜ì‹ `));\n      \n      this.results.realTimeMonitoring = {\n        messagesReceived,\n        success: true\n      };\n      \n    } catch (error: any) {\n      console.log(colors.red(`âŒ ëª¨ë‹ˆí„°ë§ ì‹¤íŒ¨: ${error.message}`));\n      this.results.realTimeMonitoring = { success: false };\n    }\n    \n    await this.delay(2000);\n  }\n\n  private static async showFinalResults(): Promise<void> {\n    console.log(colors.cyan(colors.bold('\\nğŸ“Š ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤ ìµœì¢… ê²°ê³¼')));\n    console.log(colors.cyan('='.repeat(60)));\n    \n    const scenarios = [\n      { name: 'ì‹ ê·œ ì§ì› ì˜¨ë³´ë”©', key: 'onboarding' },\n      { name: 'ì§€ëŠ¥í˜• ì‘ì—… ë§¤ì¹­', key: 'matching' },\n      { name: 'ë¶„ì‚° ì‘ì—… ì‹¤í–‰', key: 'distributedExecution' },\n      { name: 'ììœ¨ ì¥ì•  ë³µêµ¬', key: 'failureRecovery' },\n      { name: 'ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§', key: 'realTimeMonitoring' }\n    ];\n    \n    let successCount = 0;\n    \n    scenarios.forEach((scenario, index) => {\n      const result = this.results[scenario.key];\n      const success = result?.success || false;\n      \n      if (success) successCount++;\n      \n      const status = success ? colors.green('âœ… ì„±ê³µ') : colors.red('âŒ ì‹¤íŒ¨');\n      console.log(`${index + 1}. ${scenario.name}: ${status}`);\n      \n      if (result?.duration) {\n        console.log(`   â±ï¸  ì†Œìš”ì‹œê°„: ${result.duration}ms`);\n      }\n    });\n    \n    console.log(colors.cyan('\\n' + 'â”€'.repeat(60)));\n    console.log(colors.bold(`ğŸ“ˆ ì „ì²´ ì„±ê³µë¥ : ${successCount}/${scenarios.length} (${Math.round(successCount/scenarios.length*100)}%)`));\n    \n    if (successCount === scenarios.length) {\n      console.log(colors.green(colors.bold('\\nğŸ‰ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!')));\n    } else {\n      console.log(colors.yellow(colors.bold('\\nâš ï¸  ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')));\n    }\n    \n    console.log(colors.gray('\\në°ëª¨ ì™„ë£Œ ì‹œê°„: ' + new Date().toLocaleString('ko-KR')));\n  }\n\n  private static printStepHeader(title: string): void {\n    this.step++;\n    console.log(colors.cyan(colors.bold(`\\n${this.step}. ${title}`)));\n    console.log(colors.cyan('â”€'.repeat(title.length + 4)));\n  }\n\n  private static async delay(ms: number): Promise<void> {\n    await TestHelper.sleep(ms);\n  }\n}\n\n// ë°ëª¨ ì‹¤í–‰\nif (require.main === module) {\n  console.log(colors.gray('ë°ëª¨ ì‹œì‘ ì‹œê°„: ' + new Date().toLocaleString('ko-KR')));\n  \n  DemoScenario.run()\n    .then(() => {\n      console.log(colors.green(colors.bold('\\nâœ¨ ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')));\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error(colors.red(colors.bold('\\nğŸ’¥ ë°ëª¨ ì‹¤í–‰ ì‹¤íŒ¨:')), error);\n      process.exit(1);\n    });\n}\n\nexport default DemoScenario;